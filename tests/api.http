### ==============================================
### CONFIGURAÇÕES GERAIS
### ==============================================
@baseUrl = http://localhost:3000

# ATENÇÃO: Atualize estes tokens após fazer o login (1.4 e 1.5)
@farmaceuticoToken = SEU_TOKEN_AQUI
@compradorToken = SEU_TOKEN_AQUI

### ==============================================
### 1. AUTENTICAÇÃO (AUTH)
### ==============================================

### 1.1 Registrar Farmacêutico
POST {{baseUrl}}/auth/registro
Content-Type: application/json

{
  "nome": "João Farmacêutico",
  "email": "joao@farma.com",
  "senha": "123456",
  "role": "farmaceutico"
}

### 1.2 Registrar Comprador
POST {{baseUrl}}/auth/registro
Content-Type: application/json

{
  "nome": "Ana Compradora",
  "email": "ana@gmail.com",
  "senha": "123456",
  "role": "comprador"
}

### 1.3 [ERRO] Registrar com email inválido
POST {{baseUrl}}/auth/registro
Content-Type: application/json

{
  "nome": "Teste",
  "email": "emailerrado",
  "senha": "123456"
}

### 1.4 Login Farmacêutico
# Copie o token da resposta para @farmaceuticoToken
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "joao@farma.com",
  "senha": "123456"
}

### 1.5 Login Comprador
# Copie o token da resposta para @compradorToken
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "ana@gmail.com",
  "senha": "123456"
}

### 1.6 Logout
POST {{baseUrl}}/auth/logout
Authorization: Bearer {{compradorToken}}


### ==============================================
### 2. PRODUTOS (CRUD COMPLETO)
### ==============================================

### 2.1 Criar Produto 1 (Farmacêutico)
POST {{baseUrl}}/produtos
Authorization: Bearer {{farmaceuticoToken}}
Content-Type: application/json

{
  "nome": "Paracetamol 750mg",
  "apresentacao": "Caixa com 20 comprimidos",
  "fabricante": "Medley",
  "tipo": "medicamento",
  "preco": 12.50,
  "quantidade": 100
}

### 2.2 Criar Produto 2 (Farmacêutico)
POST {{baseUrl}}/produtos
Authorization: Bearer {{farmaceuticoToken}}
Content-Type: application/json

{
  "nome": "Protetor Solar FPS 50",
  "apresentacao": "200ml",
  "fabricante": "Nivea",
  "tipo": "cosmetico",
  "preco": 45.90,
  "quantidade": 50
}

### 2.3 [ERRO] Comprador tentando criar produto (403 Forbidden)
POST {{baseUrl}}/produtos
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "nome": "Produto Hacker",
  "preco": 1.00
}

### 2.4 [ERRO] Validação de Schema (Preço negativo)
POST {{baseUrl}}/produtos
Authorization: Bearer {{farmaceuticoToken}}
Content-Type: application/json

{
  "nome": "Erro Schema",
  "tipo": "medicamento",
  "preco": -10.00,
  "quantidade": 10
}

### 2.5 Listar Produtos
GET {{baseUrl}}/produtos
Authorization: Bearer {{farmaceuticoToken}}

### 2.6 Buscar Produto Específico por ID
GET {{baseUrl}}/produtos/1
Authorization: Bearer {{compradorToken}}

### 2.7 Atualizar Produto (Apenas Dono/Farmacêutico)
PATCH {{baseUrl}}/produtos/1
Authorization: Bearer {{farmaceuticoToken}}
Content-Type: application/json

{
  "nome": "Paracetamol 750mg (Oferta)",
  "preco": 9.99
}

### 2.8 Deletar Produto (Apenas Dono/Farmacêutico)
# Cuidado: Isso vai apagar o produto de ID 1
DELETE {{baseUrl}}/produtos/1
Authorization: Bearer {{farmaceuticoToken}}


### ==============================================
### 3. FAVORITOS
### ==============================================

### 3.1 Adicionar aos Favoritos (Usando produto ID 2)
POST {{baseUrl}}/favoritos
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "produto_id": 2
}

### 3.2 [ERRO] Tentar favoritar de novo o mesmo produto
POST {{baseUrl}}/favoritos
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "produto_id": 2
}

### 3.3 Listar Favoritos
GET {{baseUrl}}/favoritos
Authorization: Bearer {{compradorToken}}

### 3.4 Remover Favorito
# Passar o ID DO PRODUTO na URL
DELETE {{baseUrl}}/favoritos/2
Authorization: Bearer {{compradorToken}}


### ==============================================
### 4. CUPONS
### ==============================================

### 4.1 Criar Cupom Válido (Farmacêutico)
POST {{baseUrl}}/cupons
Authorization: Bearer {{farmaceuticoToken}}
Content-Type: application/json

{
  "codigo": "DESCONTO10",
  "desconto": 10,
  "validade": "2025-12-31"
}

### 4.2 Criar Cupom Vencido (Para teste de erro)
POST {{baseUrl}}/cupons
Authorization: Bearer {{farmaceuticoToken}}
Content-Type: application/json

{
  "codigo": "VENCIDO2020",
  "desconto": 50,
  "validade": "2020-01-01"
}

### 4.3 [ERRO] Comprador tentando criar cupom
POST {{baseUrl}}/cupons
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "codigo": "HACKER100",
  "desconto": 100,
  "validade": "2030-01-01"
}

### 4.4 Aplicar Cupom Válido (Comprador)
# Esperado: Retornar o valor do desconto
POST {{baseUrl}}/cupons/aplicar
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "codigo": "DESCONTO10"
}

### 4.5 [ERRO] Aplicar Cupom Inexistente
POST {{baseUrl}}/cupons/aplicar
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "codigo": "NAOEXISTE"
}

### 4.6 [ERRO] Aplicar Cupom Vencido
POST {{baseUrl}}/cupons/aplicar
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "codigo": "VENCIDO2020"
}


### ==============================================
### 5. CARRINHO
### ==============================================

### 5.1 Adicionar ao Carrinho (Comprador - Produto ID 2)
POST {{baseUrl}}/carrinho
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "produto_id": 2
}

### 5.2 Listar Carrinho
GET {{baseUrl}}/carrinho
Authorization: Bearer {{compradorToken}}

### 5.3 [ERRO] Adicionar produto duplicado
POST {{baseUrl}}/carrinho
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "produto_id": 2
}

### 5.4 [ERRO] Produto Inexistente
POST {{baseUrl}}/carrinho
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "produto_id": 9999
}

### 5.5 Remover do Carrinho
# Atenção: Passar o ID DO PRODUTO na URL
DELETE {{baseUrl}}/carrinho/2
Authorization: Bearer {{compradorToken}}

### 5.6 Verificar Carrinho Vazio
GET {{baseUrl}}/carrinho
Authorization: Bearer {{compradorToken}}


### ==============================================
### 6. PEDIDOS
### ==============================================

### 6.1 (Pré-requisito) Adicionar item ao carrinho novamente
POST {{baseUrl}}/carrinho
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "produto_id": 2
}

### 6.2 Criar Pedido (Comprador)
POST {{baseUrl}}/pedido
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "endereco": "Rua das Farmácias, 100",
  "metodo_pag": "pix"
}

### 6.3 [ERRO] Criar pedido com atributo obrigatório vazio
POST {{baseUrl}}/pedido
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "endereco": "",
  "metodo_pag": "cartao"
}

### 6.4 [ERRO] Criar pedido com método de pagamento inválido
POST {{baseUrl}}/pedido
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "endereco": "Águas Claras Quadra 17, Rua 10",
  "metodo_pag": "boleto"
}

### 6.5 Listar Pedidos (Visão do Farmacêutico)
GET {{baseUrl}}/pedido/farmaceutico
Authorization: Bearer {{farmaceuticoToken}}


### ==============================================
### 7. CENÁRIO DE TESTE (FLUXO COMPLETO)
### ==============================================

### 7.1 Criar Produtos novos para teste
POST {{baseUrl}}/produtos
Authorization: Bearer {{farmaceuticoToken}}
Content-Type: application/json

{
  "nome": "Ibuprofeno 600mg",
  "apresentacao": "Blister com 10 comprimidos",
  "fabricante": "Generico Lab",
  "tipo": "medicamento",
  "preco": 15.99,
  "quantidade": 20
}

### 7.2 Criar outro produto
POST {{baseUrl}}/produtos
Authorization: Bearer {{farmaceuticoToken}}
Content-Type: application/json

{
  "nome": "Teste COVID-19 Antígeno",
  "apresentacao": "Caixa com 2 Kits",
  "fabricante": "Roche Diagnostics",
  "tipo": "medicamento",
  "preco": 128.50,
  "quantidade": 25
}

### 7.3 Registrar Novo Comprador (Rodrigo)
POST {{baseUrl}}/auth/registro
Content-Type: application/json

{
  "nome": "Rodrigo Comprador",
  "email": "rodrigo@gmail.com",
  "senha": "123456",
  "role": "comprador"
}

### 7.4 Login Rodrigo
# Atualize o @compradorToken com a resposta deste login para testar como Rodrigo
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "rodrigo@gmail.com",
  "senha": "123456"
}

### 7.5 Rodrigo adiciona ao carrinho (ajuste o ID do produto conforme seu DB, ex: 3)
POST {{baseUrl}}/carrinho
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "produto_id": 3
}

### 7.6 Rodrigo cria pedido
POST {{baseUrl}}/pedido
Authorization: Bearer {{compradorToken}}
Content-Type: application/json

{
  "endereco": "W3 Oeste, Quadra 600",
  "metodo_pag": "pix"
}

### 7.7 Farmacêutico confere todos os pedidos novamente
GET {{baseUrl}}/pedido/farmaceutico
Authorization: Bearer {{farmaceuticoToken}}
